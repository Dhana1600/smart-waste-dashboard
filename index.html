<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Smart Waste Bin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#0f172a; --card:#111827; --text:#e5e7eb; --muted:#94a3b8; --accent:#22c55e; --danger:#ef4444; }
    *{box-sizing:border-box;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;}
    body{margin:0;background:linear-gradient(180deg,#0b1022,#0f172a);color:var(--text);}
    header{padding:28px 18px;text-align:center;}
    header h1{margin:0;font-weight:700;font-size:28px;letter-spacing:.3px}
    header p{margin:6px 0 0;color:var(--muted)}
    .wrap{max-width:1100px;margin:0 auto;padding:0 16px 40px}
    .grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:18px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .title{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
    .title span{color:var(--muted);font-size:14px}
    .value{font-size:40px;font-weight:800;margin:10px 0}
    progress{width:100%;height:14px;border:none;border-radius:999px;background:#0b1220;overflow:hidden}
    progress::-webkit-progress-bar{background:#0b1220}
    progress::-webkit-progress-value{background:linear-gradient(90deg,#10b981,#22c55e)}
    .controls{margin-top:24px;display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
    .row{display:flex;align-items:center;gap:12px}
    button,select{background:#0b1220;color:var(--text);border:1px solid #1f2937;border-radius:12px;padding:10px 14px;cursor:pointer;font-weight:600}
    button:active{transform:translateY(1px)}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;background:#0b1220;border:1px solid #1f2937;border-radius:999px;color:var(--muted);font-size:12px}
    footer{margin-top:22px;color:var(--muted);font-size:12px}
    .danger{color:var(--danger)}
  </style>
</head>
<body>
  <header>
    <h1>Smart Waste Bin Dashboard</h1>
    <p>Live levels â€¢ Buzzer & diverter control</p>
  </header>

  <div class="wrap">
    <div class="grid" id="cards">
      <!-- Cards generated by JS -->
    </div>

    <div class="controls card">
      <div class="title"><span>Controls</span></div>

      <div class="row">
        <button id="btnBuzzer">ðŸ”” Toggle Buzzer</button>
        <span class="pill">State: <b id="buzzerState">â€¦</b></span>
      </div>

      <div class="row">
        <label for="selDiv">ðŸš¦ Diverter:</label>
        <select id="selDiv">
          <option value="0">0 - Paper</option>
          <option value="1">1 - Plastic</option>
          <option value="2">2 - Wet</option>
          <option value="3">3 - Metal</option>
        </select>
        <span class="pill">Current: <b id="divState">â€¦</b></span>
      </div>

      <footer>Last update: <span id="lastUpdate">â€”</span></footer>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

  <script>
    // === 1) Replace with your Firebase web config ===
    const firebaseConfig = {
  apiKey: "AIzaSyA3PnnypErikHB7AxzWQoBdoDEXj9fvzl8",
  authDomain: "smartwaste-54559.firebaseapp.com",
  databaseURL: "https://smartwaste-54559-default-rtdb.firebaseio.com",
  projectId: "smartwaste-54559",
  storageBucket: "smartwaste-54559.firebasestorage.app",
  messagingSenderId: "608437398021",
  appId: "1:608437398021:web:79fe5b2362e70cc95c4a6c",
  measurementId: "G-PL74RBYS50"
}; 

    // === 2) Init Firebase ===
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // === 3) UI Helpers ===
    const bins = [
      { key: 'paper',   label: 'Paper'   },
      { key: 'plastic', label: 'Plastic' },
      { key: 'wet',     label: 'Wet'     },
      { key: 'metal',   label: 'Metal'   }
    ];

    const cardsEl = document.getElementById('cards');

    function makeCard({key, label}) {
      const el = document.createElement('div');
      el.className = 'card';
      el.innerHTML = `
        <div class="title">
          <span>${label} Bin</span>
          <span id="${key}-badge" class="pill">Status: <b>OK</b></span>
        </div>
        <div class="value"><span id="${key}-val">0</span>%</div>
        <progress id="${key}-bar" max="100" value="0"></progress>
      `;
      return el;
    }

    bins.forEach(b => cardsEl.appendChild(makeCard(b)));

    function updateCard(key, val) {
      const v = Math.max(0, Math.min(100, Number(val)||0));
      document.getElementById(`${key}-val`).textContent = v.toFixed(0);
      document.getElementById(`${key}-bar`).value = v;
      const badge = document.getElementById(`${key}-badge`);
      if (v >= 90) { badge.innerHTML = 'Status: <b class="danger">FULL</b>'; }
      else if (v >= 70) { badge.innerHTML = 'Status: <b>High</b>'; }
      else { badge.innerHTML = 'Status: <b>OK</b>'; }
    }

    function timeago(ts){
      if(!ts) return 'â€”';
      const d = new Date(ts);
      const diff = (Date.now()-d.getTime())/1000;
      if(diff<60) return `${Math.floor(diff)}s ago`;
      if(diff<3600) return `${Math.floor(diff/60)}m ago`;
      if(diff<86400) return `${Math.floor(diff/3600)}h ago`;
      return d.toLocaleString();
    }

    // === 4) Live listeners ===
    const binsRef = db.ref('bins');
    binsRef.on('value', snap => {
      const data = snap.val() || {};
      bins.forEach(b => updateCard(b.key, data[b.key] ?? 0));
      db.ref('status/lastUpdate').set(Date.now());
    });

    const buzzerRef   = db.ref('commands/buzzer');
    const diverterRef = db.ref('commands/diverter');
    const lastRef     = db.ref('status/lastUpdate');

    buzzerRef.on('value', snap => {
      document.getElementById('buzzerState').textContent = snap.val() ? 'ON' : 'OFF';
    });
    diverterRef.on('value', snap => {
      const v = Number(snap.val() ?? 0);
      document.getElementById('divState').textContent = v;
      document.getElementById('selDiv').value = String(v);
    });
    lastRef.on('value', snap => {
      document.getElementById('lastUpdate').textContent = timeago(snap.val());
    });

    // === 5) Controls â†’ write to DB ===
    document.getElementById('btnBuzzer').addEventListener('click', async () => {
      const cur = (await buzzerRef.get()).val() === true;
      buzzerRef.set(!cur);
    });

    document.getElementById('selDiv').addEventListener('change', (e) => {
      const v = Number(e.target.value||0);
      diverterRef.set(v);
    });
  </script>
</body>
</html>
